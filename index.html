<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login - Guild Manager</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: { extend: { colors: { emerald: { 50:'#ecfdf5', 100:'#d1fae5', 200:'#a7f3d0', 400:'#34d399', 500:'#10b981', 600:'#059669', 700:'#047857'} } } }
    }
  </script>
  <link rel="stylesheet" href="./style.css" />
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    /* Landing + Drawer (somente nesta página) */
    body{ background: radial-gradient(900px 500px at 10% 0%, rgba(16,185,129,0.18), transparent 60%),
                 radial-gradient(700px 420px at 90% 10%, rgba(34,197,94,0.12), transparent 55%),
                 linear-gradient(180deg, rgba(15,23,42,0.92), rgba(15,23,42,0.98)); }
    .reveal{ opacity:0; transform: translateY(18px); transition: opacity .7s ease, transform .7s ease; }
    .reveal.in{ opacity:1; transform: translateY(0); }
    .reveal[data-delay="1"]{ transition-delay: .08s; }
    .reveal[data-delay="2"]{ transition-delay: .16s; }
    .reveal[data-delay="3"]{ transition-delay: .24s; }
    .reveal[data-delay="4"]{ transition-delay: .32s; }

    /* Drawer usando #login-screen existente */
    #login-screen{ display:block; position:fixed; inset:0; z-index:99998; pointer-events:none; background:transparent; padding:0; backdrop-filter:none; }
    #login-screen .auth-overlay{ position:absolute; inset:0; background: rgba(0,0,0,.55); opacity:0; transition: opacity .25s ease; }
    #login-screen .auth-panel{ position:absolute; top:0; right:0; height:100%; width:min(480px, 100%); padding:18px; display:flex; align-items:center; justify-content:center;
      transform: translateX(102%); transition: transform .28s ease; }
    #login-screen.open{ pointer-events:auto; }
    #login-screen.open .auth-overlay{ opacity:1; }
    #login-screen.open .auth-panel{ transform: translateX(0); }
    .auth-close{ position:absolute; top:16px; right:16px; }
  </style>

</head>
<body>
  <!-- Landing Page -->
<div class="reveal rounded-3xl bg-slate-50 ring-1 ring-slate-200 p-6" data-delay="2">
          <div class="h-11 w-11 rounded-2xl bg-emerald-500/15 ring-1 ring-emerald-400/20 flex items-center justify-center">
            <i data-lucide="zap" class="h-5 w-5 text-emerald-300"></i>
          </div>
          <h3 class="mt-4 font-black text-lg">Rápido e leve</h3>
          <p class="mt-2 text-sm text-slate-900/60">Interface simples, sem peso, ideal para uso diário.</p>
        </div>

        <div class="reveal rounded-3xl bg-slate-50 ring-1 ring-slate-200 p-6" data-delay="3">
          <div class="h-11 w-11 rounded-2xl bg-emerald-500/15 ring-1 ring-emerald-400/20 flex items-center justify-center">
            <i data-lucide="badge-check" class="h-5 w-5 text-emerald-300"></i>
          </div>
          <h3 class="mt-4 font-black text-lg">Foco no FF</h3>
          <p class="mt-2 text-sm text-slate-900/60">Fluxo pensado para rotina de guilda, line e campeonato.</p>
        </div>
      </div>
    </section>

    <!-- Como funciona -->
    <section id="como-funciona" class="mx-auto max-w-6xl px-4 pb-10">
      <div class="reveal">
        <p class="text-xs font-black text-slate-900/60 tracking-widest uppercase">Como funciona</p>
        <h2 class="mt-2 text-3xl font-black tracking-tight">Em 3 passos</h2>
      </div>

      <div class="mt-8 grid gap-4 lg:grid-cols-3">
        <div class="reveal rounded-3xl bg-white/30 ring-1 ring-slate-200 p-6" data-delay="1">
          <p class="text-[11px] font-black text-emerald-300 tracking-widest uppercase">01</p>
          <h3 class="mt-2 font-black text-lg">Crie sua guilda</h3>
          <p class="mt-2 text-sm text-slate-900/60">Cadastre e defina a base: nome, líderes e regras.</p>
        </div>
        <div class="reveal rounded-3xl bg-white/30 ring-1 ring-slate-200 p-6" data-delay="2">
          <p class="text-[11px] font-black text-emerald-300 tracking-widest uppercase">02</p>
          <h3 class="mt-2 font-black text-lg">Organize membros e lines</h3>
          <p class="mt-2 text-sm text-slate-900/60">Mantenha tudo atualizado sem depender de planilhas.</p>
        </div>
        <div class="reveal rounded-3xl bg-white/30 ring-1 ring-slate-200 p-6" data-delay="3">
          <p class="text-[11px] font-black text-emerald-300 tracking-widest uppercase">03</p>
          <h3 class="mt-2 font-black text-lg">Controle com segurança</h3>
          <p class="mt-2 text-sm text-slate-900/60">Papéis definidos e ações protegidas pelas regras do Firestore.</p>
        </div>
      </div>

      <div class="reveal mt-10 rounded-3xl bg-slate-50 ring-1 ring-slate-200 p-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
        <div>
          <p class="text-sm font-black">Pronto para começar?</p>
          <p class="text-sm text-slate-900/60 mt-1">Acesse agora e monte sua guilda no HUB.</p>
        </div>
        <button id="auth-open-3" class="inline-flex items-center gap-2 rounded-2xl bg-emerald-500 px-5 py-3 text-sm font-black text-slate-950 hover:bg-emerald-400 transition">
          <i data-lucide="arrow-right" class="h-5 w-5"></i>
          Entrar
        </button>
      </div>
    </section>
  </div>

  <!-- Botão flutuante (mobile) -->
  <button id="auth-fab" class="fixed bottom-5 right-5 z-40 sm:hidden inline-flex items-center justify-center h-14 w-14 rounded-2xl bg-emerald-500 text-slate-950 shadow-2xl shadow-emerald-500/30">
    <i data-lucide="log-in" class="h-6 w-6"></i>
  </button>


  <div id="login-screen" class="login-screen">
    <div class="auth-overlay" id="auth-overlay"></div>
    <div class="auth-panel">
      <button id="auth-close" class="auth-close p-2 rounded-xl bg-white text-slate-900 hover:bg-white/15 transition" aria-label="Fechar">
        <i data-lucide="x" class="w-5 h-5"></i>
      </button>
    <div class="login-card">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-11 h-11 rounded-2xl flex items-center justify-center bg-gradient-to-br from-emerald-500/20 to-green-500/10 border border-emerald-500/30 text-emerald-600 shadow-lg shadow-emerald-500/10">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l8 4v7c0 5-3.4 9.4-8 9.4S4 18 4 13V6l8-4z"/><path d="M9 12l2 2 4-5"/></svg>
        </div>
        <div>
          <div class="text-base font-black text-gray-900 leading-tight">Guilda HUB</div>
          <div class="text-xs text-gray-500 font-medium">Acesse sua conta</div>
        </div>
      </div>

      <form id="login-form" class="flex flex-col gap-3">
        <div>
          <label class="text-xs font-bold text-gray-600 ml-1">Email</label>
          <input id="email" type="email" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none text-sm focus:border-emerald-500 focus:ring-2 focus:ring-emerald-100 transition-all" placeholder="seuemail@exemplo.com" required />
        </div>
        <div>
          <label class="text-xs font-bold text-gray-600 ml-1">Senha</label>
          <input id="password" type="password" class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none text-sm focus:border-emerald-500 focus:ring-2 focus:ring-emerald-100 transition-all" placeholder="••••••••" required />
        </div>

        <button id="btn-login" type="submit" class="mt-1 w-full py-3 rounded-xl bg-gradient-to-r from-emerald-500 to-green-600 text-slate-900 font-bold text-sm shadow-lg shadow-emerald-200 hover:shadow-xl hover:shadow-emerald-200 transition-all active:scale-95 flex items-center justify-center gap-2">
          <span>Entrar</span>
        </button>

        <div class="text-[10px] text-gray-400 text-center leading-tight px-2">
          Use um usuário de Lider ou admin de Guilda (ou login de jogador)
        </div>
      </form>
    <!-- Alternar Login/Criar conta -->
    <div class="mt-4 flex items-center justify-center gap-2 text-sm text-slate-600">
      <span id="login-hint">Não tem conta?</span>
      <button id="btn-show-signup" type="button" class="font-semibold text-emerald-700 hover:underline">Criar conta</button>
      <button id="btn-show-login" type="button" class="hidden font-semibold text-emerald-700 hover:underline">Voltar para Login</button>
    </div>

    <!-- Formulário de criação de conta -->
    <form id="signup-form" class="hidden mt-6 space-y-4">
      <div>
        <label class="block text-sm font-medium text-slate-700 mb-1" for="username">Nome de usuário (Guilda)</label>
        <input id="username" type="text" required
          class="w-full rounded-xl border border-slate-200 bg-white px-4 py-3 outline-none focus:border-emerald-400 focus:ring-2 focus:ring-emerald-200"
          placeholder="Ex: OttakuBrasil" />
        <p class="mt-1 text-xs text-slate-500">Esse nome identifica sua guilda.</p>
      </div>

      <div>
        <label class="block text-sm font-medium text-slate-700 mb-1" for="signup-email">Email</label>
        <input id="signup-email" type="email" required
          class="w-full rounded-xl border border-slate-200 bg-white px-4 py-3 outline-none focus:border-emerald-400 focus:ring-2 focus:ring-emerald-200"
          placeholder="seuemail@email.com" />
      </div>

      <div>
        <label class="block text-sm font-medium text-slate-700 mb-1" for="signup-password">Senha</label>
        <input id="signup-password" type="password" required minlength="6"
          class="w-full rounded-xl border border-slate-200 bg-white px-4 py-3 outline-none focus:border-emerald-400 focus:ring-2 focus:ring-emerald-200"
          placeholder="mínimo 6 caracteres" />
      </div>

      <button id="btn-signup" type="submit"
        class="w-full inline-flex items-center justify-center gap-2 rounded-xl bg-emerald-600 px-4 py-3 font-semibold text-slate-900 shadow-sm hover:bg-emerald-700 disabled:opacity-60">
        <span>Criar conta</span>
      </button>
    </form>


      <div class="mt-5 pt-4 border-t border-gray-100 flex justify-center gap-3 text-[11px] font-bold text-gray-400">
        <a href="https://ottakubrasil.online" target="_blank" class="text-emerald-600 hover:underline">ottakubrasil.online</a>
        <span>•</span>
        <a href="https://instagram.com/ottakubrasil" target="_blank" class="hover:text-gray-600">@ottakubrasil</a>
      </div>
    </div>
  </div>

  <script type="module">
    import { auth, showToast, checkAuth, finalizeSignup } from './logic.js';
    import { signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    // Se já estiver logado, vai pro dashboard
    checkAuth(false).then(user => {
      if(user) window.location.href = 'dashboard.html';
    });

    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const pass = document.getElementById('password').value;
      const btn = document.getElementById('btn-login');
      
      btn.disabled = true;
      btn.innerHTML = '<span class="btn-spinner"></span>';

      try {
        await signInWithEmailAndPassword(auth, email, pass);
        window.location.href = "dashboard.html?login=1";
      } catch (err) {
        console.error(err);
        let msg = "Erro ao entrar.";
        if(err.code === 'auth/invalid-credential') msg = "Email ou senha incorretos.";
        showToast('error', msg);
        btn.disabled = false;
        btn.innerHTML = '<span>Entrar</span>';
      }
    });
  
    // Alternância de telas
    const btnShowSignup = document.getElementById('btn-show-signup');
    const btnShowLogin = document.getElementById('btn-show-login');
    const loginForm = document.getElementById('login-form');
    const signupForm = document.getElementById('signup-form');
    const loginHint = document.getElementById('login-hint');

    function showSignup() {
      loginForm.classList.add('hidden');
      signupForm.classList.remove('hidden');
      btnShowSignup.classList.add('hidden');
      btnShowLogin.classList.remove('hidden');
      if (loginHint) loginHint.textContent = "Já tem conta?";
    }
    function showLogin() {
      signupForm.classList.add('hidden');
      loginForm.classList.remove('hidden');
      btnShowLogin.classList.add('hidden');
      btnShowSignup.classList.remove('hidden');
      if (loginHint) loginHint.textContent = "Não tem conta?";
    }

    btnShowSignup?.addEventListener('click', showSignup);
    btnShowLogin?.addEventListener('click', showLogin);

    // Criar conta (username + email + senha)
    signupForm?.addEventListener('submit', async (e) => {
      e.preventDefault();

      const username = document.getElementById('username').value.trim();
      const email = document.getElementById('signup-email').value.trim();
      const pass = document.getElementById('signup-password').value;

      const btn = document.getElementById('btn-signup');
      btn.disabled = true;
      btn.innerHTML = '<span class="btn-spinner"></span>';

      try {
        const cred = await createUserWithEmailAndPassword(auth, email, pass);
        await finalizeSignup(cred.user, username);

        showToast('success', 'Conta criada com sucesso!');
        window.location.href = "dashboard.html?login=1";
      } catch (err) {
        console.error(err);
        // Se criou no Auth mas falhou no Firestore, fazemos signOut para não entrar em loop.
        try { await signOut(auth); } catch(_) {}

        let msg = "Não foi possível criar a conta.";
        if (err.code === 'auth/email-already-in-use') msg = "Esse e-mail já está em uso.";
        if (err.code === 'auth/weak-password') msg = "Senha fraca (mínimo 6 caracteres).";
        if (String(err?.code || '').includes('permission-denied') || String(err?.message || '').includes('permission')) {
          msg = "Conta criada no login, mas o Firestore bloqueou a criação da guilda/config (permissões nas regras).";
        }
        showToast('error', msg);
        btn.disabled = false;
        btn.innerHTML = '<span>Criar conta</span>';
      }
    });
</script>

    </div>
    </div>
  </div>

<!-- OTK Footer -->
  <footer id="otk-footer" class="mt-12 border-t border-emerald-500/10 bg-white text-slate-900">
    <div class="mx-auto w-full max-w-5xl px-4 py-10">
      <div class="flex flex-col items-center gap-4">
        <div class="flex items-center justify-center gap-3">
          <a href="https://instagram.com/ottakubrasil" target="_blank" rel="noopener noreferrer"
             class="flex h-11 w-11 items-center justify-center rounded-full bg-white ring-1 ring-slate-200 transition hover:bg-white/15"
             aria-label="Instagram principal: @ottakubrasil" title="@ottakubrasil">
            <i data-lucide="instagram" class="h-5 w-5"></i>
          </a>
          <a href="https://instagram.com/gameotk" target="_blank" rel="noopener noreferrer"
             class="flex h-11 w-11 items-center justify-center rounded-full bg-white ring-1 ring-slate-200 transition hover:bg-white/15"
             aria-label="Instagram gaming: @gameotk" title="@gameotk">
            <i data-lucide="instagram" class="h-5 w-5"></i>
          </a>
          <a href="https://ottakubrasil.online" target="_blank" rel="noopener noreferrer"
             class="flex h-11 w-11 items-center justify-center rounded-full bg-white ring-1 ring-slate-200 transition hover:bg-white/15"
             aria-label="Site: ottakubrasil.online" title="ottakubrasil.online">
            <i data-lucide="globe" class="h-5 w-5"></i>
          </a>
        </div>

        <div class="text-center">
          <p class="text-sm font-semibold tracking-wide text-slate-900/90">Ottakubrasil • Guilda Hub</p>
          <p class="mt-2 max-w-xl text-xs leading-relaxed text-slate-900/65">
            Central de guilda e eventos: organização, velocidade e controle para facilitar sua vida no dia a dia.
          </p>
          <p class="mt-4 text-xs text-slate-900/50">© Ottakubrasil</p>
        </div>
      </div>
    </div>
  </footer>

  
  <script>
    // Drawer (Login/Cadastro)
    (function(){
      const drawer = document.getElementById('login-screen');
      const overlay = document.getElementById('auth-overlay');
      const btns = ['auth-open','auth-open-2','auth-open-3','auth-fab'].map(id => document.getElementById(id)).filter(Boolean);
      const closeBtn = document.getElementById('auth-close');

      function openDrawer(){
        drawer.classList.add('open');
        document.documentElement.classList.add('overflow-hidden');
        document.body.classList.add('overflow-hidden');
      }
      function closeDrawer(){
        drawer.classList.remove('open');
        document.documentElement.classList.remove('overflow-hidden');
        document.body.classList.remove('overflow-hidden');
      }

      btns.forEach(b => b.addEventListener('click', openDrawer));
      overlay?.addEventListener('click', closeDrawer);
      closeBtn?.addEventListener('click', closeDrawer);

      window.addEventListener('keydown', (e) => {
        if(e.key === 'Escape') closeDrawer();
      });
    })();

    // Scroll reveal (entra e sai ao rolar)
    (function(){
      const els = document.querySelectorAll('.reveal');
      const io = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if(entry.isIntersecting) entry.target.classList.add('in');
          else entry.target.classList.remove('in');
        });
      }, { threshold: 0.12, rootMargin: '0px 0px -10% 0px' });

      els.forEach(el => io.observe(el));
    })();
  </script>


  <script>
    try { window.lucide && window.lucide.createIcons && window.lucide.createIcons(); } catch(_) {}
  </script>

</body>
</html>