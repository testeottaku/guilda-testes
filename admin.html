<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Guilda</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-50 flex text-gray-800 font-sans">

    <div class="lg:hidden fixed top-4 left-4 z-50">
        <button id="menu-btn" class="bg-white p-2 rounded-lg shadow text-emerald-600"><i data-lucide="menu"></i></button>
    </div>

    <aside id="sidebar" class="w-64 bg-white border-r h-screen fixed -translate-x-full lg:translate-x-0 transition-transform z-40">
        <div class="p-6 flex items-center gap-3 border-b">
            <div class="bg-emerald-500 text-white p-2 rounded-lg"><i data-lucide="shield"></i></div>
            <span class="font-bold">Painel Guilda</span>
        </div>
        <nav class="p-4 space-y-2">
            <a href="dashboard.html" class="flex gap-3 px-4 py-3 text-gray-500 hover:bg-gray-100 rounded-xl transition"><i data-lucide="layout-dashboard"></i> Dashboard</a>
            <a href="membros.html" class="flex gap-3 px-4 py-3 text-gray-500 hover:bg-gray-100 rounded-xl transition"><i data-lucide="users"></i> Membros</a>
            <a href="campeonato.html" class="flex gap-3 px-4 py-3 text-gray-500 hover:bg-gray-100 rounded-xl transition"><i data-lucide="swords"></i> Campeonato</a>
            <a href="admin.html" class="flex gap-3 px-4 py-3 bg-emerald-50 text-emerald-700 rounded-xl font-medium"><i data-lucide="settings"></i> Admin</a>
            <button onclick="window.authApi.logout().then(()=>location.href='index.html')" class="w-full flex gap-3 px-4 py-3 text-red-500 hover:bg-red-50 rounded-xl mt-10"><i data-lucide="log-out"></i> Sair</button>
        </nav>
    </aside>

    <main class="flex-1 lg:ml-64 min-h-screen p-6">
        <header class="bg-white/80 backdrop-blur border-b p-4 mb-6 rounded-2xl sticky top-0 z-30">
            <h1 class="font-bold text-lg">Configurações de Acesso</h1>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-5xl mx-auto">
            
            <div class="bg-white p-6 rounded-2xl border shadow-sm">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-gray-900 flex gap-2"><i data-lucide="crown" class="text-yellow-500"></i> Administradores</h3>
                    <button onclick="add('admins')" class="text-xs bg-emerald-100 text-emerald-700 px-3 py-1 rounded-lg font-bold hover:bg-emerald-200">Adicionar</button>
                </div>
                <p class="text-xs text-gray-400 mb-4">Acesso total ao sistema.</p>
                <ul id="list-admins" class="space-y-2"></ul>
            </div>

            <div class="bg-white p-6 rounded-2xl border shadow-sm">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-gray-900 flex gap-2"><i data-lucide="medal" class="text-blue-500"></i> Líderes</h3>
                    <button onclick="add('leaders')" class="text-xs bg-emerald-100 text-emerald-700 px-3 py-1 rounded-lg font-bold hover:bg-emerald-200">Adicionar</button>
                </div>
                <p class="text-xs text-gray-400 mb-4">Acesso de visualização e edição de membros.</p>
                <ul id="list-leaders" class="space-y-2"></ul>
            </div>

        </div>
    </main>

    <script type="module">
        import "./firebase.js";
        
        // Mobile Menu
        document.getElementById('menu-btn').onclick = () => document.getElementById('sidebar').classList.toggle('-translate-x-full');

        let securityData = { admins: [], leaders: [] };

        window.onload = async () => {
            if(!await window.authApi.check()) return;
            load();
        };

        async function load() {
            securityData = await window.guildDB.getSecurity();
            renderList('admins', securityData.admins || []);
            renderList('leaders', securityData.leaders || []);
            lucide.createIcons();
        }

        function renderList(type, list) {
            const ul = document.getElementById(`list-${type}`);
            ul.innerHTML = "";
            if(list.length === 0) ul.innerHTML = "<li class='text-sm text-gray-300 italic'>Nenhum usuário</li>";
            
            list.forEach(email => {
                const li = document.createElement('li');
                li.className = "flex justify-between items-center bg-gray-50 p-3 rounded-xl text-sm border";
                li.innerHTML = `
                    <span class="truncate pr-2">${email}</span>
                    <button onclick="remove('${type}', '${email}')" class="text-red-400 hover:text-red-600"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                `;
                ul.appendChild(li);
            });
        }

        window.add = async (type) => {
            const email = prompt("Digite o e-mail do usuário (Gmail):");
            if(!email) return;
            const cleanEmail = email.toLowerCase().trim();
            
            if(!securityData[type]) securityData[type] = [];
            if(securityData[type].includes(cleanEmail)) return alert("Já existe!");

            securityData[type].push(cleanEmail);
            await save();
        };

        window.remove = async (type, email) => {
            if(!confirm(`Remover acesso de ${email}?`)) return;
            securityData[type] = securityData[type].filter(e => e !== email);
            await save();
        };

        async function save() {
            try {
                await window.guildDB.saveSecurity(securityData);
                load();
            } catch(e) { alert("Erro ao salvar: " + e.message); }
        }
    </script>
</body>
</html>
